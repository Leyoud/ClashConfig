---
# Download https://raw.gitmirror.com/Leyoud/LEYOUD/master/Clash/config/user_config_Mini.yaml
#
#-------------------------------------------------------------#
# Clashä½¿ç”¨æ‰‹å†Œ https://dreamacro.github.io/clash/zh_CN
# Clashç®¡ç†é¢æ¿ https://clash.razord.top https://yacd.haishan.me
#-------------------------------------------------------------#
# cfw General (Home Directory/config.yaml)
mixed-port: 7890
external-ui: ./
log-level: info
allow-lan: false
bind-address: "*"
external-controller: 127.0.0.1:9090
secret: ""
ipv6: false
#-------------------------------------------------------------#
# cfw Profiles (Home Directory/profiles/xxxx.yaml)
mode: rule
authentication: []
interface-name: ""

# é…ç½®è¯´æ˜:
# 1. user_config_Mini.yaml åŸºäº clash-premium
# 2. defaults.subURL       åŸºäº https://github.com/tindy2013/subconverter
# 3. rule-providers        åŸºäº https://github.com/ACL4SSR/ACL4SSR https://github.com/blackmatrix7/ios_rule_script

defaults:
  {
    # æ·»åŠ æœåŠ¡å•†æä¾›è®¢é˜…(url=...), sub.xeton.dev(subconverteräº‘ç«¯) | 127.0.0.1:25500(subconverteræœ¬åœ°)
    subURL: &subURL "http://sub.xeton.dev/sub?target=clash&url=|è®¢é˜…é“¾æ¥1|è®¢é˜…é“¾æ¥2|è®¢é˜…é“¾æ¥++|https%3A%2F%2Fraw.githubusercontent.com%2FLeyoud%2FLEYOUD%2Fmaster%2FClash%2Fconfig%2Fproxies_Debug.yaml&new_name=true&list=true&udp=true",

    # è®¢é˜…å’Œè§„åˆ™æ›´æ–°æ—¶é—´(s)
    providersInterval: &providersInterval 86400, # 24h

    # å»¶è¿Ÿæµ‹è¯•åœ°å€ & é—´éš”æ—¶é•¿(s) & æ‡’æµ‹è¯•(bool)
    delayInterval: &delayInterval { url: https://www.gstatic.com/generate_204, interval: 300, lazy: true},

    # url-test å»¶è¿Ÿå®¹å·®(ms)
    urlTestTolerance: &urlTestTolerance 150
  }

dns:
  {
    enable: true, listen: 0.0.0.0:53, ipv6: true, use-hosts: true,

    enhanced-mode: fake-ip, fake-ip-range: 198.18.0.1/16, fake-ip-filter: ["*.msftncsi.com", "*.msftconnecttest.com"],

    nameserver: [tls://dns.alidns.com:853, https://dns.alidns.com/dns-query], # default-nameserver: [223.6.6.6, 223.5.5.5],

    fallback: [208.67.222.222, 208.67.220.220, https://doh.opendns.com/dns-query], fallback-filter: { geoip: true, geoip-code: CN }
  }

hosts: { localhost: 127.0.0.1, ip6-localhost: "::1"}

tun: { enable: true, stack: gvisor, auto-route: true, auto-detect-interface: true, dns-hijack: [any:53] }

proxies:
  - {
      name: ğŸ¶ è§£é”ç½‘æ˜“äº‘ç°è‰²æ­Œæ›²(æœ¬åœ°), type: http, server: 127.0.0.1, port: 8080 # unblockneteasemusic server
    }

proxy-providers:
    {
      all: { url: *subURL, type: http, path: ./providers/proxy/all.yaml, interval: *providersInterval,
      health-check: { enable: true, <<: *delayInterval } }
    }

proxy-groups:
  - {
      name: ğŸš€ ä»£ç†æœåŠ¡, type: select, proxies: [â™»ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸ”° æ‰‹åŠ¨é€‰æ‹©, DIRECT, REJECT]
    }

  - {
      name: ğŸ”° æ‰‹åŠ¨é€‰æ‹©, type: select, proxies: [],
      use: [all]
    }

  - {
      name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©, type: url-test, proxies: [], <<: *delayInterval, tolerance: *urlTestTolerance,
      use: [all]
    }

  - {
      name: ğŸ¶ ç½‘æ˜“éŸ³ä¹, type: select, proxies: [DIRECT, ğŸ¶ è§£é”ç½‘æ˜“äº‘ç°è‰²æ­Œæ›²(æœ¬åœ°)]
    }

  - {
      name: ğŸ¯ å…¨çƒç›´è¿, type: select, proxies: [DIRECT, REJECT]
    }

  - {
      name: ğŸ† å…¨çƒæ‹¦æˆª, type: select, proxies: [REJECT, DIRECT]
    }

  - {
      name: ğŸŸ æ¼ç½‘ä¹‹é±¼, type: select, proxies: [ğŸš€ ä»£ç†æœåŠ¡, â™»ï¸ è‡ªåŠ¨é€‰æ‹©, DIRECT, ğŸ”° æ‰‹åŠ¨é€‰æ‹©]
    }
rule-providers:
    # å±€åŸŸç½‘ç›´è¿
    # Start
    Lan:
        type: http
        behavior: classical
        path: ./providers/rule/Lan.yaml
        url: https://raw.gitmirror.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml
        interval: *providersInterval

    ProcessNameDirectlist:
        type: http
        behavior: classical
        path: ./providers/rule/ProcessNameDirectlist.yaml
        url: https://raw.gitmirror.com/Leyoud/LEYOUD/master/Clash/rules/ProcessNameDirectlist.yaml
        interval: *providersInterval
    # End

    # å…¨çƒæ‹¦æˆª
    # Start
    Advertising:
        type: http
        behavior: classical
        path: ./providers/rule/Advertising.yaml
        url: https://raw.gitmirror.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising_Classical.yaml
        interval: *providersInterval

    AdvertisingAppend:
        type: http
        behavior: classical
        path: ./providers/rule/AdvertisingAppend.yaml
        url: https://raw.gitmirror.com/Leyoud/LEYOUD/master/Clash/rules/AdvertisingAppend.yaml
        interval: *providersInterval
    # End

    # å…¨çƒç›´è¿(ä¸€)
    # Start
    GoogleCN:
        type: http
        behavior: classical
        path: ./providers/rule/GoogleCN.yaml
        url: https://raw.gitmirror.com/ACL4SSR/ACL4SSR/master/Clash/Providers/Ruleset/GoogleCN.yaml
        interval: *providersInterval

    SteamCN:
        type: http
        behavior: classical
        path: ./providers/rule/SteamCN.yaml
        url: https://raw.gitmirror.com/blackmatrix7/ios_rule_script/master/rule/Clash/SteamCN/SteamCN.yaml
        interval: *providersInterval

    AmazonCN:
        type: http
        behavior: classical
        path: ./providers/rule/AmazonCN.yaml
        url: https://raw.gitmirror.com/blackmatrix7/ios_rule_script/master/rule/Clash/AmazonCN/AmazonCN.yaml
        interval: *providersInterval
    # End

    # ç½‘æ˜“éŸ³ä¹
    NeteaseMusic:
        type: http
        behavior: classical
        path: ./providers/rule/NetEaseMusic.yaml
        url: https://raw.gitmirror.com/blackmatrix7/ios_rule_script/master/rule/Clash/NetEaseMusic/NetEaseMusic.yaml
        interval: *providersInterval

    # ä»£ç†æœåŠ¡
    # Start
    GlobalProxylist:
        type: http
        behavior: classical
        path: ./providers/rule/GlobalProxylist.yaml
        url: https://raw.gitmirror.com/Leyoud/LEYOUD/master/Clash/rules/GlobalProxylist.yaml
        interval: *providersInterval

    Global:
        type: http
        behavior: classical
        path: ./providers/rule/Global.yaml
        url: https://raw.gitmirror.com/blackmatrix7/ios_rule_script/master/rule/Clash/Global/Global_Classical.yaml
        interval: *providersInterval
    # End

    # å…¨çƒç›´è¿(äºŒ)
    # Start
    ChinaDirectlist:
        type: http
        behavior: classical
        path: ./providers/rule/ChinaDirectlist.yaml
        url: https://raw.gitmirror.com/Leyoud/LEYOUD/master/Clash/rules/ChinaDirectlist.yaml
        interval: *providersInterval

    China:
        type: http
        behavior: classical
        path: ./providers/rule/China.yaml
        url: https://raw.gitmirror.com/blackmatrix7/ios_rule_script/master/rule/Clash/China/China_Classical.yaml
        interval: *providersInterval

    ChinaIPs:
        type: http
        behavior: classical
        path: ./providers/rule/ChinaIPs.yaml
        url: https://raw.gitmirror.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaIPs/ChinaIPs_Classical.yaml
        interval: *providersInterval

    Download:
        type: http
        behavior: classical
        path: ./providers/rule/Download.yaml
        url: https://raw.gitmirror.com/blackmatrix7/ios_rule_script/master/rule/Clash/Download/Download.yaml
        interval: *providersInterval
    # End

rules:
  # å±€åŸŸç½‘ç›´è¿
  - RULE-SET,Lan,DIRECT
  - RULE-SET,ProcessNameDirectlist,DIRECT

  # å…¨çƒæ‹¦æˆª
  - RULE-SET,Advertising,ğŸ† å…¨çƒæ‹¦æˆª
  - RULE-SET,AdvertisingAppend,ğŸ† å…¨çƒæ‹¦æˆª

  # å…¨çƒç›´è¿(ä¸€)
  - RULE-SET,GoogleCN,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,SteamCN,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,AmazonCN,ğŸ¯ å…¨çƒç›´è¿

  # ç½‘æ˜“éŸ³ä¹
  - PROCESS-NAME,cloudmusic.exe,ğŸ¶ ç½‘æ˜“éŸ³ä¹
  - PROCESS-NAME,com.netease.cloudmusic,ğŸ¶ ç½‘æ˜“éŸ³ä¹
  - RULE-SET,NeteaseMusic,ğŸ¶ ç½‘æ˜“éŸ³ä¹

  # ä»£ç†æœåŠ¡
  - RULE-SET,GlobalProxylist,ğŸš€ ä»£ç†æœåŠ¡
  - RULE-SET,Global,ğŸš€ ä»£ç†æœåŠ¡

  # å…¨çƒç›´è¿(äºŒ)
  - RULE-SET,ChinaDirectlist,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,China,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,ChinaIPs,ğŸ¯ å…¨çƒç›´è¿,no-resolve
  - RULE-SET,Download,ğŸ¯ å…¨çƒç›´è¿
  - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿

  # æ¼ç½‘ä¹‹é±¼
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼